import tensorflow_hub as hub
import tensorflow.compat.v1 as tf
import json


def load_reports():
    with open('datasets/reports.json') as file:
        data = json.load(file)

    reports = []
    labels = []
    for report in data['reports']:
        reports.append(report['report'])
        labels.append(report['label'])
    return reports, labels


def embed(reports):
    # Compute a representation for each message, showing various lengths supported.
    word = "Elephant"
    sentence = "I am a sentence for which I would like to get its embedding."
    paragraph = (
        "Universal Sentence Encoder embeddings also support short paragraphs. "
        "There is no hard limit on how long the paragraph is. Roughly, the longer "
        "the more 'diluted' the embedding will be.")
    messages = [word, sentence, paragraph]

    with tf.Session() as session:
        embed = hub.load("https://tfhub.dev/google/universal-sentence-encoder/4")
        session.run([tf.global_variables_initializer(), tf.tables_initializer()])
        report_embeddings = session.run(embed(reports))
    print(report_embeddings.shape)
    print('done')
    # print(report_embeddings.shape)
    # embeddings = embed(messages)

    return report_embeddings


reports, labels = load_reports()
print(len(reports))
print(len(labels))
embed(reports)