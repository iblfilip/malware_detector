from sklearn.svm import SVC
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import StandardScaler
from helpers.utils import save, load
import logging

logger = logging.getLogger(__name__)


class SVCModel:
    def __init__(self, config):
        """
        Init SVC model, load model from local path if do_training = False
        :param config: configuration object
        """

        self.config = config
        self.model_path = self.config.get('output_dir') + self.config.get('model_name') + '.svc'
        if self.config.get('do_training'):
            logger.info('Initializing SVC model with config')
            self.config.print()
            model = SVC(
                gamma=self.config.get('gamma'),
                kernel=self.config.get('kernel'),
                random_state=self.config.get('random_value')
            ),
            self.classifier = make_pipeline(StandardScaler(), model[0])
        else:
            logger.info('Loading SVC model from ' + self.model_path)
            self.classifier = load(self.model_path)

    def train(self, x_train, y_train, save_model=False):
        """
        Train model on training dataset
        :param x_train: train reports dataset
        :param y_train: list of labels for train reports dataset
        :param save_model: mark whether save model after training
        """
        logger.info('    Training SVC')
        self.classifier.fit(x_train, y_train)

        if save_model:
            logger.info('Saving SVC model to ' + self.model_path)
            save(self.model_path, self.classifier)

    def predict(self, x, dataset_name):
        """
        Predict dataset using trained model
        :param x: dataset of test reports
        :param dataset_name: name of dataset, for logging purposes
        :return: prediction
        """
        logger.info('    SVC predict on ' + dataset_name)
        return self.classifier.predict(x)
